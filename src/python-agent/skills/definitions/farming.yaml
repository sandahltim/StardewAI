# Farming Skills for StardewAI
# These skills handle crop management on the farm

# =============================================================================
# WATERING
# =============================================================================

water_crop:
  description: "Water an unwatered planted crop (auto-equips watering can)"
  category: farming
  energy_cost: 2

  preconditions:
    required:
      - type: has_item
        item: Watering Can

  actions:
    - select_slot: 2  # Watering Can
    - face: "{target_direction}"
    - use_tool

  on_success:
    message: "Watered the crop"
    updates:
      - crop.isWatered: true

  on_failure:
    no_tool:
      message: "No watering can in inventory"
    can_empty:
      message: "Watering can is empty"
      recovery_skill: refill_watering_can

refill_watering_can:
  description: "Refill watering can at a water source (pond, river, well)"
  category: farming
  energy_cost: 0

  preconditions:
    required:
      - type: adjacent_to
        target: water_source

  actions:
    # Auto-equip watering can (slot 2) before refilling
    - select_slot: 2
    - wait: 0.2
    - face: "{target_direction}"
    - wait: 0.1
    - use_tool

  on_success:
    message: "Refilled watering can"

  on_failure:
    not_adjacent:
      message: "Not adjacent to water"
      recovery_skill: navigate_to_water

equip_watering_can:
  description: "Select the watering can from toolbar"
  category: farming
  energy_cost: 0

  preconditions:
    required:
      - type: has_item
        item: Watering Can

  actions:
    - select_slot: 2  # Watering Can is typically slot 2

  on_success:
    message: "Equipped Watering Can"

  on_failure:
    no_item:
      message: "No Watering Can in inventory"

# =============================================================================
# HARVESTING
# =============================================================================

harvest_crop:
  description: "Pick a mature crop that is ready for harvest"
  category: farming
  energy_cost: 0

  preconditions:
    required:
      - type: adjacent_to
        target: ready_crop

  actions:
    - face: "{target_direction}"
    - harvest: "{target_direction}"

  on_success:
    message: "Harvested {crop_name}"
    updates:
      - inventory: add {crop_yield}

  on_failure:
    not_adjacent:
      message: "Not adjacent to a ready crop"
      recovery_skill: navigate_to_crop
    not_ready:
      message: "Crop is not ready for harvest yet"

# =============================================================================
# PLANTING
# =============================================================================

plant_seed:
  description: "Plant seeds on tilled soil (auto-selects seeds from inventory)"
  category: farming
  energy_cost: 0

  preconditions:
    required:
      - type: standing_on
        target: tilled_soil
      - type: has_item_category
        category: seeds

  actions:
    - select_item_type: seed  # Auto-find and select seeds
    - use_tool  # Plant the selected seeds

  on_success:
    message: "Planted seeds"
    updates:
      - tile.state: planted

  on_failure:
    wrong_tile:
      message: "Not standing on tilled soil"
      recovery_skill: till_soil
    no_seeds:
      message: "No seeds equipped"
      recovery_skill: equip_seeds

equip_seeds:
  description: "Select seeds from inventory"
  category: farming
  energy_cost: 0

  preconditions:
    required:
      - type: has_item_category
        category: seeds

  actions:
    - select_slot: "{seed_slot}"

  on_success:
    message: "Equipped {seed_name}"

  on_failure:
    no_seeds:
      message: "No seeds in inventory - buy from Pierre's"

# =============================================================================
# SOIL PREPARATION
# =============================================================================

till_soil:
  description: "Use hoe to till adjacent ground for planting (specify direction)"
  category: farming
  energy_cost: 2

  preconditions:
    required:
      - type: has_item
        item: Hoe

  actions:
    - select_slot: 1  # Hoe
    - face: "{target_direction}"  # VLM must specify: north/south/east/west
    - use_tool

  on_success:
    message: "Tilled the soil to the {target_direction}"
    updates:
      - tile.state: tilled

  on_failure:
    no_tool:
      message: "No hoe in inventory"

equip_hoe:
  description: "Select the hoe from toolbar"
  category: farming
  energy_cost: 0

  preconditions:
    required:
      - type: has_item
        item: Hoe

  actions:
    - select_slot: 1  # Hoe is typically slot 1

  on_success:
    message: "Equipped Hoe"

# =============================================================================
# DEBRIS CLEARING
# =============================================================================

clear_weeds:
  description: "Cut weeds or grass with scythe (auto-equips, free energy!)"
  category: farming
  energy_cost: 0

  preconditions:
    required:
      - type: has_item
        item: Scythe

  actions:
    - select_slot: 4  # Scythe
    - face: "{target_direction}"
    - use_tool

  on_success:
    message: "Cleared weeds"
    drops: [Mixed Seeds, Fiber]

  on_failure:
    no_tool:
      message: "No scythe in inventory"

equip_scythe:
  description: "Select the scythe from toolbar"
  category: farming
  energy_cost: 0

  preconditions:
    required:
      - type: has_item
        item: Scythe

  actions:
    - select_slot: 4  # Scythe is typically slot 4

  on_success:
    message: "Equipped Scythe"

clear_stone:
  description: "Break small stones with pickaxe (auto-equips)"
  category: farming
  energy_cost: 2

  preconditions:
    required:
      - type: has_item
        item: Pickaxe

  actions:
    - select_slot: 3  # Pickaxe
    - face: "{target_direction}"
    - use_tool

  on_success:
    message: "Cleared stone"
    drops: [Stone]

  on_failure:
    no_tool:
      message: "No pickaxe in inventory"

equip_pickaxe:
  description: "Select the pickaxe from toolbar"
  category: farming
  energy_cost: 0

  preconditions:
    required:
      - type: has_item
        item: Pickaxe

  actions:
    - select_slot: 3  # Pickaxe is typically slot 3

  on_success:
    message: "Equipped Pickaxe"

clear_wood:
  description: "Chop branches or twigs with axe (auto-equips)"
  category: farming
  energy_cost: 2

  preconditions:
    required:
      - type: has_item
        item: Axe

  actions:
    - select_slot: 0  # Axe
    - face: "{target_direction}"
    - use_tool

  on_success:
    message: "Cleared wood"
    drops: [Wood]

  on_failure:
    no_tool:
      message: "No axe in inventory"

equip_axe:
  description: "Select the axe from toolbar"
  category: farming
  energy_cost: 0

  preconditions:
    required:
      - type: has_item
        item: Axe

  actions:
    - select_slot: 0  # Axe is typically slot 0

  on_success:
    message: "Equipped Axe"

chop_tree:
  description: "Chop down a tree (multiple hits required)"
  category: farming
  energy_cost: 10  # Trees take ~10 hits

  preconditions:
    required:
      - type: adjacent_to
        target: tree
      - type: equipped
        item: Axe

  actions:
    - face: "{target_direction}"
    - use_tool
    - use_tool
    - use_tool
    - use_tool
    - use_tool
    - use_tool
    - use_tool
    - use_tool
    - use_tool
    - use_tool

  on_success:
    message: "Chopped down tree"
    drops: [Wood, Tree Seeds]

  on_failure:
    not_adjacent:
      message: "Not adjacent to tree"
    wrong_tool:
      message: "Axe not equipped"
      recovery_skill: equip_axe

# =============================================================================
# SHIPPING / SELLING
# =============================================================================

ship_item:
  description: "Ship a sellable item to sell overnight (auto-selects from inventory)"
  category: farming
  energy_cost: 0

  preconditions:
    required:
      - type: at_location
        location: Farm
      - type: has_sellable

  actions:
    - select_item_type: sellable  # Auto-find and select a shippable item
    - ship: -1  # Ship the selected item (SMAPI accesses bin remotely)

  on_success:
    message: "Shipped item - will sell overnight"

  on_failure:
    not_on_farm:
      message: "Must be on Farm to ship items"
      recovery_skill: go_to_farm
    no_items:
      message: "No sellable items in inventory"

# =============================================================================
# SHOPPING / BUYING
# =============================================================================

buy_seeds:
  description: "Buy seeds from Pierre's shop (must be inside SeedShop)"
  category: farming
  energy_cost: 0

  preconditions:
    required:
      - type: at_location
        location: SeedShop

  actions:
    - buy:
        item: "{seed_type}"
        quantity: "{quantity}"

  on_success:
    message: "Bought {quantity} {seed_type}"

  on_failure:
    wrong_location:
      message: "Not at Pierre's shop - go_to_pierre first"
      recovery_skill: go_to_pierre
    not_enough_money:
      message: "Not enough gold to buy seeds"
    shop_closed:
      message: "Pierre's is closed (Wed or outside 9AM-5PM)"

buy_parsnip_seeds:
  description: "Buy 5 parsnip seeds (100g total, 4 days to grow, spring crop)"
  category: farming
  energy_cost: 0

  preconditions:
    required:
      - type: at_location
        location: SeedShop
      - type: has_money
        amount: 100

  actions:
    - buy:
        item: "parsnip seeds"
        quantity: 5

  on_success:
    message: "Bought 5 parsnip seeds (100g)"

buy_cauliflower_seeds:
  description: "Buy cauliflower seeds (80g each, 12 days, spring crop, high value)"
  category: farming
  energy_cost: 0

  preconditions:
    required:
      - type: at_location
        location: SeedShop
      - type: has_money
        amount: 80

  actions:
    - buy:
        item: "cauliflower seeds"
        quantity: 1

  on_success:
    message: "Bought 1 cauliflower seed (80g)"

buy_potato_seeds:
  description: "Buy 2 potato seeds (100g total, 6 days, spring crop, chance of bonus)"
  category: farming
  energy_cost: 0

  preconditions:
    required:
      - type: at_location
        location: SeedShop
      - type: has_money
        amount: 100

  actions:
    - buy:
        item: "potato seeds"
        quantity: 2

  on_success:
    message: "Bought 2 potato seeds (100g)"

# =============================================================================
# COMPOSITE SKILLS (higher-level workflows)
# =============================================================================

water_all_crops:
  description: "Water all unwatered crops on the farm"
  category: farming
  composite: true

  steps:
    - skill: navigate_to_crop
      params: {target: nearest_unwatered}
    - skill: water_crop
      repeat_until: no_unwatered_crops

  on_complete:
    message: "All crops watered!"

harvest_all_ready:
  description: "Harvest all crops that are ready"
  category: farming
  composite: true

  steps:
    - skill: navigate_to_crop
      params: {target: nearest_ready}
    - skill: harvest_crop
      repeat_until: no_ready_crops

  on_complete:
    message: "All ready crops harvested!"

morning_farm_routine:
  description: "Complete morning farming chores: water crops, harvest ready, check animals"
  category: farming
  composite: true

  steps:
    - skill: harvest_all_ready
    - skill: water_all_crops
    - skill: ship_item
      condition: inventory_has_sellables

  on_complete:
    message: "Morning farm routine complete!"
